---
title: "eatGADS - Datenaufbereitung"
author: "Benjamin Becker, Annika Liebelt & Jule Burblies"
date: "2024-11-12"
title-slide-attributes:
  data-background-image: eatGADS.png
  data-background-size: 25%
  data-background-repeat: no-repeat
  data-background-position: 95% 5%
format: revealjs
editor: visual
execute:
  echo: true
---

## eatGADS

**Scope**

-   Datenbankerstellung
-   Datenbanknutzung
-   Datenaufbereitung
-   Datenprüfung


## Ursprüngliche Idee

R statt SPSS in der Datenaufbereitung

-   keine proprietäre Software
-   bessere Automatisierungsmöglichkeiten
-   bessere Integration mit dem eat-Versum

```{r}
#| eval: true
#| echo: false
#| 
library(eatGADS)
```

## eatGADS

![](eatGADS_CRAN.jpg)

```{r}
#| eval: false
#| echo: true

# Stabile Version
install.packages("eatGADS")

# Development Version
remotes::install_github("beckerbenj/eatGADS")
```

## GADSdat-Objekte

Liste bestehend aus 

- rohen Daten (`dat`) 
- und Meta-Daten (`labels`)

## GADSdat-Objekte

**Daten**

![](GADSdat_dat.jpg){ height=50% }

## GADSdat-Objekte

**Meta-Daten**

![](GADSdat_labels.jpg){ height=50% }

## GADSdat-Objekte

Import und Export

```{r}
#| eval: false
#| echo: true

# Import von .sav/.dta files
pisa <- import_spss("pisa.sav")
pisa <- import_stata("pisa.dat")

# Export von .sav/.dta files
write_spss(pisa, filePath = "pisa.sav")
write_stata(pisa, filePath = "pisa.dat")
```

## Meta-Daten

Extraktion von Meta-Daten via `extractMeta()`

```{r}
#| eval: true

extractMeta(pisa, vars = "schtype")

```

## Meta-Daten

Änderung von Meta-Daten

```{r}
#| eval: true

# Variablenlabel
pisa2 <- changeVarLabels(pisa, varName = "schtype",
                         varLabel = "Schulart")

# Wertelabel
pisa2 <- changeValLabels(pisa2, varName = "schtype",
                         value = 1, valLabel = "Gymnasium")

# Missingtag
pisa2 <- changeMissings(pisa2, varName = "schtype",
                         value = -99, missings = "miss")

```

## Meta-Daten

```{r}
#| eval: true

extractMeta(pisa2, vars = "schtype")

```

## Daten

Änderung von Daten

```{r}
#| eval: true

# Variable duplizieren
pisa3 <- cloneVariable(pisa2, varName = "schtype",
                       new_varName = "schtype_dich")

# Rekodierung
pisa3 <- recodeGADS(pisa3, varName = "schtype_dich",
                    oldValues = c(1, 2, 3),
                    newValues = c(1, 2, 2),
                    existingMeta = "drop")

# Anpassung Wertelabel
pisa3 <- changeValLabels(pisa3, varName = "schtype_dich",
                     value = 2, valLabel = "Nicht-Gymnasium")
```

## Daten

```{r}
#| eval: true

extractMeta(pisa3, vars = "schtype_dich")[, 1:6]
extractMeta(pisa3, vars = "schtype_dich")[, 7:8]

```

## Übung

- Lade den Datensatz x.
- Inspiziere die Meta-Daten der Variablen y und z.
- Vergebe sinnvolle ...


## Übersicht Funktionalität I

Import-Funktionen

-   import_spss()
-   import_stata()
-   import_DF()
-   import_RDS()
-   import_raw()

Export-Funktionen

-   write_spss()
-   write_stata()
-   extractData2()

## Übersicht Funktionalität II

Meta-Daten bearbeiten

-   getChangeMeta()
-   applyChangeMeta()
-   changeVarLabels()
-   changeValLabels()
-   changeMissings()
-   changeVarNames()
-   changeSPSSformat()
-   reuseMeta()
-   updateMeta()

## Übersicht Funktionalität III

Grundlegende Daten-Struktur bearbeiten

-   extractVars()
-   removeVars()
-   cloneVar()
-   relocateVariable()
-   orderLike()
-   insertVariable()


## Übersicht Funktionalität IV

Semi-automatisierte Funktionen

-   collapseMC_Text()
-   collapseMultiMC_Text()
-   ...


## Übung

- Welche Funktionen sind geeignet um...?
- Welche Funktionen sind geeignet um...?


## Check-Funktionen

-   Konventionen Variablennamen
-   Umlaute & Sonderzeichen
-   Abgleich Wertelabels & Missingtags
-   Abgleich Daten & Wertelabels

## Variablennamen

**Konventionen Variablennamen**

-   → Automatisch beim Import
    -   `_` vs `.`
    -   Geschützte Wörter

![](aepfel_spss.JPG){width="80%"}

## Variablennamen

**Konventionen Variablennamen**

-   → Automatisch beim Import
    -   `_` vs `.`
    -   Geschützte Wörter

```{r}
# Import SPSS data
aepfel <- import_spss("aepfel.sav")

```

## Test-Datensatz

**Test-Daten**

```{r}
# Display the dataset
aepfel$dat
```

## Test-Datensatz

**Test-Daten**

```{r}
aepfel$labels[, c("varName", "varLabel", "value", "valLabel", "missings")]
```

## Sonderzeichen

**Umlaute & Sonderzeichen umwandeln**

-   Variablenlabel, Wertelabel, Daten
-   `ß` zu `ss`, `ä` zu `ae` usw.
-   Vorbeugen von Encoding-Problemen

```{r}
# Fix encoding issues
aepfel <- fixEncoding(aepfel)
```

## Sonderzeichen

**Umlaute & Sonderzeichen umwandeln**

```{r}
# Display the dataset after fixing encoding
aepfel$dat
```

## Sonderzeichen

**Umlaute & Sonderzeichen umwandeln**

```{r}
# Display specific columns of the labels data
aepfel$labels[, c("varName", "varLabel", "value", "valLabel", "missings")]
```

## Abgleich Missingtags

**Abgleich Wertelabels und Missingtags**

-   Alle Werte mit spezifischen Labels auch als Missing getagged?
-   Alle als Missing getaggeden Werte auch spezifische Labels?

→ Reporting und/oder Anpassung

```{r}
# Check and adjust missing tags
aepfel <- checkMissings(aepfel, missingLabel = "Missing|missing")
```

## Abgleich Wertelabels

**Abgleich Daten und Wertelabels**

-   Alle Werte mit Wertelabels auch in Daten?

```{r}
# Check if all value labels are present in the data
checkEmptyValLabels(aepfel)
```

## Abgleich Wertelabels

**Abgleich Daten und Wertelabels**

-   Alle Werte in den Daten auch mit Wertelabels?

```{r}
# Check if all values in the data have value labels for specific variables
checkMissingValLabels(aepfel, vars = c("Ae_Groesse", "Ae_Qualitaet"))
```

## 

::: {style="text-align: center;"}
<h1 style="font-size: 2em;">

Danke für Eure

</h1>

<h1 style="font-size: 2em;">

Aufmerksamkeit!

</h1>
:::

\vspace{2cm}

::: {style="font-size: small;"}
<https://CRAN.R-project.org/package=eatGADS>\
<https://github.com/beckerbenj/eatFDZ>
:::
